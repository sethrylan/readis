name: demo-dispatch

on:
  issue_comment:
    types: [created]

permissions:
  actions: write

jobs:
  dispatch:
    if: >-
      github.event.issue.pull_request &&
      github.event.comment.body == '/demo' &&
      contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.comment.author_association)
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch demo generation
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh workflow run demo-generate.yml \
            --repo ${{ github.repository }} \
            -f pr_number=${{ github.event.issue.number }}
